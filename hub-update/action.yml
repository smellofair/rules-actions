name: "Hub Update"
description: "This does the logic of pulling in the latest version of a given language"
inputs:
  source:
    description: "The name of the source repo"
    required: true
  pat:
    description: "A Personal Access Token"
    required: true

runs:
  using: "composite"
  steps:
    - name: "Checkout hub repo"
      uses: actions/checkout@v4
      with:
        token: ${{ inputs.pat }}
        submodules: true

    - name: "Initialize Submodules"
      shell: bash
      run: |
        git submodule init;
        git submodule update;

    - name: "Configure Identity"
      shell: bash
      run: |
        git config --global user.name "Cephalobot"
        git config --global user.email "cephalobot@j.diode.pw"

    - name: "Add / Update Submodule"
      shell: bash
      env:
        PAT: ${{ inputs.pat }}
        SOURCE: ${{ inputs.source }}
      run: |
        ls -lhR;

        RULE_LANG="${SOURCE: -2}";
        SUBMODULE_PATH="translations/${RULE_LANG}";
        SUBMODULE_GIT_URL="https://x-access-token:${PAT}@github.com/${SOURCE}.git";


        echo "Checking for ${RULE_LANG}";
        if [ -e "${SUBMODULE_PATH}" ]; then
          echo "Updating submodule...";
          git submodule update --remote --checkout -f "${SUBMODULE_PATH}";
          git status;

        else
          echo "Creating submodule...";
          git submodule add "${SUBMODULE_GIT_URL}" "${SUBMODULE_PATH}";
          git commit -m "Adding ${SOURCE} to translations";
        fi

        git push;
